# EFRIS-DOC

# EFRIS API Documentation

## Overview
EFRIS (Electronic Fiscal Receipting and Invoicing Solution) API allows businesses to generate and manage electronic invoices in Uganda. This documentation provides guidance on how to integrate with the EFRIS system.

> **IMPORTANT:** Ensure the TIN number is VAT Registered when using EFRIS.

## Invoice Template Structure

The EFRIS API requires a structured JSON object for creating invoices. Below is the standard template:

```javascript
let efrisInvoice = {
    airlineGoodsDetails: [],
    basicInformation: {
        // antifakeCode: "", // Generated by system
        currency: 'UGX',
        currencyRate: '1',
        dataSource: '103',
        deviceNo: '1011020583_01', // Device number obtained from EFRIS
        invoiceId: '',             // Generated by system
        invoiceIndustryCode: '101',
        // invoiceKind: "2",       // "1" - true, "2" - false
        invoiceNo: '',             // Generated by system
        invoiceType: '1',
        isBatch: '0',
        isInvalid: '0',
        isPreview: '0',
        isRefund: '0',
        issuedDate: '',           // Generated by system
        issuedDatePdf: '',        // Generated by system
        operator: 'operatorName', // Your system operator
        payWay: '102',            // Payment method code
    },
    buyerDetails: {
        buyerEmail: 'customer@example.com',
        buyerLegalName: 'Customer Name',
        buyerSector: 'Customer Sector', // e.g., 'Telecommunications Industry'
        buyerType: '1',                 // Customer type code
        dateFormat: 'dd/MM/yyyy',
        nowTime: '2025/03/06 10:45:52', // Current timestamp
        pageIndex: 0,
        pageNo: 0,
        pageSize: 0,
        timeFormat: 'dd/MM/yyyy HH24:mi:ss',
    },
    extend: {},
    goodsDetails: [
        {
            deemedFlag: '2',         // "1" - true, "2" - false
            discountFlag: '2',       // "1" - true, "2" - false
            exciseFlag: '2',         // "1" - true, "2" - false
            exciseTax: '0',
            goodsCategoryId: '90111801', // Category ID from EFRIS
            goodsCategoryName: 'Single room', // Category name
            invoiceItemId: '',       // Generated by system
            item: 'item-name',       // Item name
            itemCode: 'item-code',   // Your internal item code
            orderNumber: '0',        // Sequence number
            qty: '1',                // Quantity
            tax: '0',                // Tax amount
            taxRate: '0',            // Tax rate (e.g., 0.18 for 18%)
            total: '100000',         // Total amount
            unitOfMeasure: 'PD',     // Unit of measure code
            unitPrice: '100000',     // Unit price
            vatApplicableFlag: '1',  // "1" - VAT applicable, "2" - not applicable
        },
        // Additional items as needed
    ],
    payWay: [],
    sellerDetails: {
        address: 'BUSINESS ADDRESS',
        branchCode: '00',
        referenceNo: 'uuidv4()',     // Generate a UUID for reference
        branchId: '823422647462730017', // Obtained from EFRIS
        branchName: 'BUSINESS NAME',
        businessName: 'BUSINESS NAME',
        emailAddress: 'business@example.com',
        legalName: 'BUSINESS LEGAL NAME',
        linePhone: '2567XXXXXXXX',
        mobilePhone: '2567XXXXXXXX',
        ninBrn: 'XXXXX/', // Business Registration Number
        placeOfBusiness: 'BUSINESS LOCATION',
        tin: '1011020583', // TIN obtained from URA
    },
    summary: {
        grossAmount: '100000', // Total amount including taxes
        itemCount: '1',        // Number of items
        modeCode: '1',
        netAmount: '100000',   // Amount without taxes
        qrCode: '',            // Generated by system
        taxAmount: '0',        // Total tax amount
    },
    taxDetails: [
        {
            grossAmount: '100000', // Total amount before tax
            netAmount: '100000',   // Net amount
            taxAmount: '0',        // Tax amount
            taxCategory: 'A: Standard',
            taxCategoryCode: '01',
            taxRate: '0',          // Tax rate (e.g., 0.18 for 18%)
            taxRateName: '18%',    // Tax rate display name
        },
    ],
};
```

## API Integration Examples

### Example 1: Using Fetch API with async/await

```javascript
// Step 1: Prepare the Invoice Data
let efrisInvoice = {
    // Your invoice data following the template
};

// Step 2: Create Request Body
const requestBody = {
    data: JSON.stringify(efrisInvoice),
    interfaceCode: 'T109',
    tin: "1011020453",
    deviceNo: '1011020453_01',
};

// Step 3: Set Request Options
const requestOptions = {
    method: 'POST',
    headers: {
        'Content-Type': 'application/json',
    },
    body: JSON.stringify(requestBody),
};

// Step 4: Make the API Request
const EFRIS_BASE_URL = 'https://efris-api-endpoint.example.com'; // Replace with actual EFRIS base URL

const response = await fetch(
    `${EFRIS_BASE_URL}/api/EfrisApi`,
    requestOptions
);

const result = await response.text();
console.log(result);
```

### Example 2: Using Fetch API with Promises

```javascript
// Set up headers
const myHeaders = new Headers();
myHeaders.append("Content-Type", "application/json");

// Prepare the request body
const raw = JSON.stringify({
  "data": "{\n   \n    \"airlineGoodsDetails\": [],\n    \"basicInformation\": {\n      \"antifakeCode\": \"\",\n      \"currency\": \"UGX\",\n      \"currencyRate\": \"1\",\n      \"dataSource\": \"103\",\n      \"deviceNo\": \"1011020583_01\",\n      \"invoiceId\": \"\",\n      \"invoiceIndustryCode\": \"101\",\n      \"invoiceKind\": \"1\",\n      \"invoiceNo\": \"\",\n      \"invoiceType\": \"1\",\n      \"isBatch\": \"0\",\n      \"isInvalid\": \"0\",\n      \"isPreview\": \"0\",\n      \"isRefund\": \"0\",\n      \"issuedDate\": \"\",\n      \"issuedDatePdf\": \"\",\n      \"operator\": \"Micheal\",\n      \"payWay\": \"102\"\n    },\n    \"buyerDetails\": {\n      \"buyerEmail\": \"michaelRizz@gmail.com\",\n      \"buyerLegalName\": \"Michael\",\n      \"buyerSector\": \"Telecommunications Industry\",\n      \"buyerType\": \"1\",\n      \"dateFormat\": \"dd/MM/yyyy\",\n      \"nowTime\": \"2025/03/06 10:45:52\",\n      \"pageIndex\": 0,\n      \"pageNo\": 0,\n      \"pageSize\": 0,\n      \"timeFormat\": \"dd/MM/yyyy HH24:mi:ss\"\n    },\n    \"extend\": {},\n    \"goodsDetails\": [\n      {\n        \"deemedFlag\": \"2\",\n        \"discountFlag\": \"2\",\n        \"exciseFlag\": \"2\",\n        \"exciseTax\": \"0\",\n        \"goodsCategoryId\": \"90111801\",\n        \"goodsCategoryName\": \"Single room\",\n        \"invoiceItemId\": \"\",\n        \"item\": \"nile-inn\",\n        \"itemCode\": \"sm\",\n        \"orderNumber\": \"0\",\n        \"qty\": \"1\",\n        \"tax\": \"0\",\n        \"taxRate\": \"0\",\n        \"total\": \"100000\",\n        \"unitOfMeasure\": \"PD\",\n        \"unitPrice\": \"100000\",\n        \"vatApplicableFlag\": \"1\"\n      }\n    ],\n    \"payWay\": [],\n    \"sellerDetails\": {\n      \"address\": \"NTINDA KAMPALA NAKAWA DIVISION NAKAWA DIVISION\",\n      \"branchCode\": \"00\",\n      \"branchId\": \"823422647462730017\",\n      \"branchName\": \"Mr. MICHAEL Rizz\",\n      \"businessName\": \"Mr. MICHAEL Rizz\",\n      \"emailAddress\": \"nthakkar@ura.go.ug\",\n      \"legalName\": \"Mr. MICHAEL Rizz\",\n      \"linePhone\": \"2560778497936\",\n      \"mobilePhone\": \"2560778497936\",\n      \"ninBrn\": \"004652632/\",\n      \"placeOfBusiness\": \"NTINDA KAMPALA NAKAWA DIVISION NAKAWA DIVISION\",\n      \"tin\": \"1011020583\"\n    },\n    \"summary\": {\n      \"grossAmount\": \"100000\",\n      \"itemCount\": \"1\",\n      \"modeCode\": \"1\",\n      \"netAmount\": \"100000\",\n      \"qrCode\": \"\",\n      \"taxAmount\": \"0\"\n    },\n    \"taxDetails\": []\n  }",
  "interfaceCode": "T109",
  "tin": "1011020583",
  "deviceNo": "1011020583_01"
});

// Configure request options
const requestOptions = {
  method: "POST",
  headers: myHeaders,
  body: raw,
  redirect: "follow"
};

// Make the API call
fetch("{{EFRISBASEURL}}/api/EfrisApi", requestOptions)
  .then((response) => response.text())
  .then((result) => console.log(result))
  .catch((error) => console.error(error));
```

> **Note:** Replace `{{EFRISBASEURL}}` with your actual EFRIS API base URL.

## Response Format

A successful API response will be returned as a stringified JSON object with the following structure:

```json
{
  "data": "{\"Data\":\"{\\u0022airlineGoodsDetails\\u0022:[],\\u0022basicInformation\\u0022:{\\u0022antifakeCode\\u0022:\\u002238382298593398226066\\u0022,...}}\",\"ReturnMessage\":\"SUCCESS\",\"ReturnCode\":\"00\",\"Version\":\"1.1.20191201\"}",
  "returnMessage": "SUCCESS",
  "returnCode": "00",
  "version": null
}
```

The response contains important information:
- `data`: Contains the complete invoice data with generated fields filled in
- `returnMessage`: Status message ("SUCCESS" for successful transactions)
- `returnCode`: Response code ("00" indicates success)

## Key Generated Fields

Upon successful processing, the EFRIS system will return several important generated fields:

- `invoiceId`: Unique identifier for the invoice
- `invoiceNo`: Invoice number for reference
- `antifakeCode`: Security code for verification
- `issuedDate`: Official issue date and time
- `qrCode`: QR code data for the invoice

## Code Reference Values

### Invoice Codes
- `"1"` - true
- `"2"` - false

### Payment Methods
- `102` - Cash (refer to EFRIS documentation for other codes)

### Tax Categories
- `01` - Standard (18% VAT)

### Unit of Measure
- `PD` - Per Day (for accommodations)
- `207` - For conference rooms

## Additional Notes

- This is documentation for integration purposes. Always test in a development environment before moving to production.
- Keep your TIN and device numbers secure.
- For support, contact the Uganda Revenue Authority (URA) EFRIS support team.



```javascript
let testEfrisinvoice = {
    // NOTE: This is a dummy invoice for testing purposes only. It should not be used in production.
    // The invoice is created with the following details:
    // - Invoice codes "1" - true, "2" - false

    airlineGoodsDetails: [],
    basicInformation: {
        // antifakeCode: "",
        currency: 'UGX',
        currencyRate: '1',
        dataSource: '103',
        deviceNo: '1011020583_01', // This is the device number obtained from Efris
        invoiceId: '',
        invoiceIndustryCode: '101',
        // invoiceKind: "2",
        invoiceNo: '',
        invoiceType: '1',
        isBatch: '0',
        isInvalid: '0',
        isPreview: '0',
        isRefund: '0',
        issuedDate: '',
        issuedDatePdf: '',
        operator: 'michaelRizz',
        payWay: '102',
    },
    buyerDetails: {
        buyerEmail: 'michaelRizz@gmail.com',
        buyerLegalName: 'Michael',
        buyerSector: 'Telecommunications Industry',
        buyerType: '1',
        dateFormat: 'dd/MM/yyyy',
        nowTime: '2025/03/06 10:45:52',
        pageIndex: 0,
        pageNo: 0,
        pageSize: 0,
        timeFormat: 'dd/MM/yyyy HH24:mi:ss',
    },
    extend: {},
    goodsDetails: [
        {
            deemedFlag: '2',
            discountFlag: '2',
            exciseFlag: '2',
            exciseTax: '0',
            goodsCategoryId: '90111801', // This is the room code mapped from Efris goodsCategoryId
            goodsCategoryName: 'Single room', // This is the room code mapped from Efris goodsCategoryName
            invoiceItemId: '', // This is the room code mapped from Efris invoiceItemId
            item: 'nile-inn', // This is the room code mapped from Efris item
            itemCode: 'sm', // This is the room code mapped from Efris itemCode
            orderNumber: '0', // This is sequence following on order after the other
            qty: '1', // This is actual quantity of the room booked (number of booked rooms)
            tax: '0', // actual tax amount
            taxRate: '0', // This is the tax rate for the room booked or service
            total: '100000',
            unitOfMeasure: 'PD', // This is the room code mapped from Efris unitOfMeasure
            unitPrice: '100000', // This is the room code mapped from Efris unitPrice
            vatApplicableFlag: '1',
        },
    ],
    payWay: [],
    sellerDetails: {
        // This is the seller details obtained ie the business
        address: 'NTINDA KAMPALA NAKAWA DIVISION NAKAWA DIVISION',
        branchCode: '00',
        referenceNo: 'uuidv4()', // Generate this yourself

        branchId: '823422647462730017',
        branchName: 'Mr. MICHAEL RIZZ',
        businessName: 'Mr. MICHAEL RIZZ',
        emailAddress: 'nthakkar@ura.go.ug',
        legalName: 'Mr. MICHAEL RIZZ',
        linePhone: '2560778497936',
        mobilePhone: '2560778497936',
        ninBrn: '004652632/',
        placeOfBusiness: 'NTINDA KAMPALA NAKAWA DIVISION NAKAWA DIVISION',
        tin: '1011020583', // This is the TIN obtained from URA
    },
    summary: {
        grossAmount: '100000', // This is the total amount of the goods or services
        itemCount: '1',
        modeCode: '1',
        netAmount: '100000', // This is net amount without taxes
        qrCode: '',
        taxAmount: '0', // This is the total tax amount
    },
    taxDetails: [
        {
            grossAmount: '100000', // This is the total amount of the goods or services without tax
            netAmount: '100000', // This is net amount after taxes
            taxAmount: '0', // This is the total tax amount
            taxCategory: 'A: Standard',
            taxCategoryCode: '01',
            taxRate: '0', // This is the tax rate for the room booked or service
            taxRateName: `18%`, // This is the tax
        },
    ],
};

```







